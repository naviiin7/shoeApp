<!-- DARK PRODUCT LIST WRAPPER -->
<div class="products-page-wrapper py-10">
  <div class="max-w-7xl mx-auto px-6">

    <!-- DARK FUTURISTIC FILTER BAR -->
    <div
      class="filter-bar flex items-center gap-3 mb-6 flex-wrap px-4 py-3 rounded-xl shadow border border-white/10">
      
      <!-- Category -->
      <select
        #catSelect
        (change)="onFilterCategory(catSelect.value)"
        [value]="category"
        class="compact-select w-28"
      >
        <option value="all">Category</option>
        <option *ngFor="let c of categories" [value]="c">{{ c }}</option>
      </select>

      <!-- Size -->
      <select
        #sizeSelect
        (change)="onFilterSize(sizeSelect.value)"
        [value]="selectedSize"
        class="compact-select w-20"
      >
        <option value="all">Size</option>
        <option *ngFor="let s of sizes" [value]="s">{{ s }}</option>
      </select>

      <!-- Sort -->
      <select
        #sortSelect
        (change)="onSort(sortSelect.value)"
        [value]="sort"
        class="compact-select w-24"
      >
        <option value="">Sort</option>
        <option value="price-asc">Price ‚Üë</option>
        <option value="price-desc">Price ‚Üì</option>
        <option value="name-asc">A ‚Üí Z</option>
      </select>

      <div class="ml-2 text-sm text-muted whitespace-nowrap">
        Showing <span class="font-semibold">{{ filtered.length }}</span>
        item{{ filtered.length === 1 ? '' : 's' }}
      </div>

      <div class="flex-1"></div>

      <!-- SEARCH BAR -->
      <div class="flex items-center">

        <button *ngIf="!showSearch"
                (click)="toggleSearch()"
                class="futuristic-search-btn"
                title="Search">
          üîç
        </button>

        <div *ngIf="showSearch" class="flex items-center gap-2 animate-fade-in">
          <input
            #searchInput
            [(ngModel)]="searchQuery"
            (keyup.enter)="doSearch()"
            placeholder="Search products..."
            class="search-input"
          />
          <button (click)="doSearch()" class="futuristic-search-btn px-3">Go</button>
          <button (click)="toggleSearch()" class="compact-close">‚úï</button>
        </div>

      </div>

    </div>

    <!-- PRODUCT GRID -->
    <div *ngIf="!loading && paginated.length > 0"
         class="grid gap-8 grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3">

      <article *ngFor="let p of paginated; trackBy: trackById"
               class="product-card-upgraded">

        <button (click)="gotoDetail(p)" class="block cursor-pointer text-left w-full bg-transparent border-0 p-0">
          <div class="image-frame">
            <img [src]="p.image || defaultImageFor(0)"
                 [alt]="p.name"
                 class="product-image-upgraded"
                 (error)="onImgError($event)" />
          </div>
        </button>

        <div class="pt-4 px-2 pb-2">
          <div class="flex justify-between items-start mb-2">
            <div>
              <div class="font-semibold text-white text-sm truncate">{{ p.name }}</div>
              <div class="text-xs text-gray-400">{{ p.brand }}</div>
            </div>
            <div class="text-accent font-bold text-sm">${{ p.price }}</div>
          </div>

          <div class="mt-3 flex gap-3">
            <button (click)="gotoDetail(p)" class="btn-view">View</button>
            <button (click)="addToCartInList($event, p)" class="btn-add">Add</button>
          </div>
        </div>

      </article>

    </div>

    <div *ngIf="!loading && paginated.length === 0"
         class="text-center py-10 text-muted">
      No products found.
    </div>

    <!-- PAGINATION -->
    <div class="flex justify-center gap-4 mt-10">
      <button (click)="prevPage()" [disabled]="currentPage === 1"
              class="page-btn">Prev</button>
      <div class="text-sm text-muted">
        Page {{ currentPage }} of {{ totalPages }}
      </div>
      <button (click)="nextPage()" [disabled]="currentPage >= totalPages"
              class="page-btn">Next</button>
    </div>

  </div>
</div>
